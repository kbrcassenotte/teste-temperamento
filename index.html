<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Descubra seu Temperamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        .slide-in-right { animation: slideInRight 0.3s ease-out; }
        .slide-in-left { animation: slideInLeft 0.3s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        
        /* Custom scrollbar for aesthetics */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "recharts": "https://esm.sh/recharts@^3.6.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-800 antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-10">
        <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="app.restart()">
                <div class="w-8 h-8 bg-teal-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">T</div>
                <span class="font-semibold text-slate-700 tracking-tight hidden sm:inline">Temperament Compass</span>
                <span class="font-semibold text-slate-700 tracking-tight sm:hidden">Compass</span>
            </div>
            <div id="step-indicator" class="text-xs font-medium text-slate-400 uppercase tracking-widest"></div>
        </div>
    </header>

    <!-- Main Container -->
    <main id="app" class="flex-grow container mx-auto px-2 md:px-4 py-6 flex flex-col items-center justify-start">
        <!-- Content will be injected here via JavaScript -->
    </main>

    <!-- Icons helper -->
    <script>
        const Icons = {
            compass: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg>`,
            arrowRight: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
            arrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>`,
            checkCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
            chevronRight: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>`,
            refresh: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></svg>`,
            share: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></svg>`,
            alert: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>`
        };

        // --- DATA ---
        const PROFILES = {
            'A': { id: 'A', name: "Influente", alias: "Sanguíneo", description: "Você é uma pessoa comunicativa, entusiasta e sociável. Sua energia contagia o ambiente e você adora interagir com pessoas.", strengths: ["Otimismo contagiante", "Facilidade de comunicação", "Criatividade", "Entusiasmo"], weaknesses: ["Desorganização", "Impulsividade", "Dificuldade em focar em detalhes"], color: "#fbbf24", bg: "bg-amber-400" },
            'B': { id: 'B', name: "Dominante", alias: "Colérico", description: "Você é um líder natural, focado em resultados e metas. É direto, enérgico e gosta de resolver problemas rapidamente.", strengths: ["Liderança", "Determinação", "Foco em resultados", "Autoconfiança"], weaknesses: ["Impaciência", "Pode parecer insensível", "Dificuldade em delegar"], color: "#ef4444", bg: "bg-red-500" },
            'C': { id: 'C', name: "Conforme", alias: "Melancólico", description: "Você é analítico, detalhista e busca a perfeição. Valoriza a qualidade, a lógica e o planejamento profundo.", strengths: ["Capacidade analítica", "Perfeccionismo", "Lealdade", "Organização"], weaknesses: ["Crítico demais", "Indecisão por excesso de análise", "Pessimismo"], color: "#3b82f6", bg: "bg-blue-500" },
            'D': { id: 'D', name: "Estável", alias: "Fleumático", description: "Você é calmo, diplomático e um excelente ouvinte. Busca harmonia, evita conflitos e é muito consistente em suas tarefas.", strengths: ["Diplomacia", "Paciência", "Constância", "Bom ouvinte"], weaknesses: ["Acomodação", "Medo de mudanças", "Dificuldade em dizer não"], color: "#10b981", bg: "bg-emerald-500" },
        };

        const QUESTIONS = [
            { id: 1, category: "Trabalho", text: "Diante de um novo projeto desafiador, sua primeira reação é:", options: [
                { id: "1a", text: "Ficar empolgado com as novas possibilidades e reunir a equipe para brainstorm.", type: 'A' },
                { id: "1b", text: "Definir imediatamente o objetivo final e traçar o caminho mais rápido para chegar lá.", type: 'B' },
                { id: "1c", text: "Analisar os dados, riscos e criar um plano detalhado antes de começar.", type: 'C' },
                { id: "1d", text: "Verificar como isso afeta a rotina atual e garantir que todos estejam confortáveis.", type: 'D' }
            ]},
            { id: 2, category: "Trabalho", text: "Como você lida com prazos apertados?", options: [
                { id: "2b", text: "Trabalho intensamente e pressiono quem for necessário para entregar.", type: 'B' },
                { id: "2a", text: "Tento negociar ou improvisar uma solução criativa de última hora.", type: 'A' },
                { id: "2d", text: "Mantenho a calma e sigo o fluxo, fazendo o que é possível sem estresse.", type: 'D' },
                { id: "2c", text: "Fico ansioso se a qualidade for comprometida, mas foco no detalhe essencial.", type: 'C' }
            ]},
            { id: 3, category: "Trabalho", text: "O que mais te desmotiva no ambiente profissional?", options: [
                { id: "3c", text: "Falta de processos claros e desorganização generalizada.", type: 'C' },
                { id: "3d", text: "Conflitos constantes e pressão agressiva.", type: 'D' },
                { id: "3a", text: "Tarefas repetitivas, isolamento e falta de reconhecimento.", type: 'A' },
                { id: "3b", text: "Lentidão, indecisão e falta de autonomia.", type: 'B' }
            ]},
            { id: 4, category: "Social", text: "Em uma festa onde você conhece poucas pessoas, você:", options: [
                { id: "4a", text: "Rapidamente faço amizade, conto histórias e viro o centro das atenções.", type: 'A' },
                { id: "4d", text: "Fico observando ou converso apenas com quem eu já conheço.", type: 'D' },
                { id: "4b", text: "Aproveito para fazer networking se for útil, ou lidero a escolha do que fazer.", type: 'B' },
                { id: "4c", text: "Prefiro conversas profundas com uma única pessoa a interagir com o grupo todo.", type: 'C' }
            ]},
            { id: 5, category: "Social", text: "Ao planejar as férias em grupo, seu papel geralmente é:", options: [
                { id: "5c", text: "Pesquisar roteiros, preços e garantir que nada dê errado.", type: 'C' },
                { id: "5a", text: "Animar o grupo e sugerir as atividades mais divertidas.", type: 'A' },
                { id: "5d", text: "Concordar com a maioria para manter o clima agradável.", type: 'D' },
                { id: "5b", text: "Decidir o destino e tomar as rédeas da organização logística.", type: 'B' }
            ]},
            { id: 6, category: "Social", text: "Como você reage a uma surpresa inesperada?", options: [
                { id: "6d", text: "Fico tranquilo, não demonstro muita emoção externa.", type: 'D' },
                { id: "6a", text: "Adoro! Expresso minha alegria de forma visível e barulhenta.", type: 'A' },
                { id: "6c", text: "Desconfio ou fico preocupado com o impacto na minha programação.", type: 'C' },
                { id: "6b", text: "Avalio rapidamente se é algo bom ou se vai atrapalhar meus planos.", type: 'B' }
            ]},
            { id: 7, category: "Conflitos", text: "Durante uma discussão acalorada, você tende a:", options: [
                { id: "7b", text: "Impor minha opinião e falar mais alto para vencer o argumento.", type: 'B' },
                { id: "7d", text: "Me calar ou ceder para acabar logo com a briga.", type: 'D' },
                { id: "7a", text: "Levar para o lado emocional e, às vezes, falar coisas sem pensar.", type: 'A' },
                { id: "7c", text: "Usar argumentos lógicos e fatos, ou me retirar se a conversa ficar irracional.", type: 'C' }
            ]},
            { id: 8, category: "Conflitos", text: "Se alguém te critica injustamente, você:", options: [
                { id: "8c", text: "Guardo mágoa e fico remoendo aquilo por muito tempo.", type: 'C' },
                { id: "8b", text: "Revido na hora e defendo meu ponto de vista com firmeza.", type: 'B' },
                { id: "8a", text: "Fico triste no momento, mas logo esqueço e perdoo.", type: 'A' },
                { id: "8d", text: "Ignoro para evitar estresse, mesmo que me incomode por dentro.", type: 'D' }
            ]},
            { id: 9, category: "Conflitos", text: "Para resolver um problema complexo, você prefere:", options: [
                { id: "9a", text: "Discutir com outras pessoas para ter ideias novas.", type: 'A' },
                { id: "9b", text: "Tomar uma decisão rápida e corrigir o curso depois, se necessário.", type: 'B' },
                { id: "9c", text: "Estudar todas as variáveis antes de dar qualquer passo.", type: 'C' },
                { id: "9d", text: "Esperar para ver se o problema se resolve ou buscar uma solução pacífica.", type: 'D' }
            ]},
            { id: 10, category: "Planejamento", text: "Como é sua relação com a organização pessoal?", options: [
                { id: "10c", text: "Tudo tem seu lugar. Minha agenda é sagrada e detalhada.", type: 'C' },
                { id: "10a", text: "Sou um pouco caótico, perco coisas, mas me acho na minha bagunça.", type: 'A' },
                { id: "10b", text: "Organizo o essencial para ser eficiente, sem perfeccionismo exagerado.", type: 'B' },
                { id: "10d", text: "Tenho uma rotina estável, mas não gosto de planejar muito a longo prazo.", type: 'D' }
            ]},
            { id: 11, category: "Planejamento", text: "Ao fazer compras no supermercado:", options: [
                { id: "11a", text: "Compro o que me dá vontade na hora, muitas vezes fujo da lista.", type: 'A' },
                { id: "11c", text: "Sigo rigorosamente a lista, comparo preços e leio rótulos.", type: 'C' },
                { id: "11b", text: "Sou rápido, pego o que preciso e saio o quanto antes.", type: 'B' },
                { id: "11d", text: "Sigo o mesmo caminho de sempre, comprando as marcas habituais.", type: 'D' }
            ]},
            { id: 12, category: "Planejamento", text: "Sua meta de vida principal se aproxima mais de:", options: [
                { id: "12b", text: "Ter sucesso, poder e realizar grandes feitos.", type: 'B' },
                { id: "12d", text: "Ter paz, estabilidade e uma vida tranquila.", type: 'D' },
                { id: "12c", text: "Fazer tudo com excelência e corrigir o que está errado no mundo.", type: 'C' },
                { id: "12a", text: "Ser feliz, ter muitos amigos e viver experiências intensas.", type: 'A' }
            ]}
        ];

        const KEYWORDS = [
            { id: "k1", text: "Expressivo", type: 'A' }, { id: "k2", text: "Entusiasta", type: 'A' }, { id: "k3", text: "Sociável", type: 'A' }, { id: "k4", text: "Espontâneo", type: 'A' }, { id: "k5", text: "Otimista", type: 'A' },
            { id: "k6", text: "Determinado", type: 'B' }, { id: "k7", text: "Competitivo", type: 'B' }, { id: "k8", text: "Independente", type: 'B' }, { id: "k9", text: "Corajoso", type: 'B' }, { id: "k10", text: "Produtivo", type: 'B' },
            { id: "k11", text: "Detalhista", type: 'C' }, { id: "k12", text: "Analítico", type: 'C' }, { id: "k13", text: "Sensível", type: 'C' }, { id: "k14", text: "Organizado", type: 'C' }, { id: "k15", text: "Idealista", type: 'C' },
            { id: "k16", text: "Calmo", type: 'D' }, { id: "k17", text: "Paciente", type: 'D' }, { id: "k18", text: "Diplomático", type: 'D' }, { id: "k19", text: "Conservador", type: 'D' }, { id: "k20", text: "Equilibrado", type: 'D' }
        ].sort(() => Math.random() - 0.5);

        // --- APP LOGIC ---
        const app = {
            state: {
                step: 'welcome',
                quizIndex: 0,
                maxReachedIndex: 0,
                quizAnswers: new Array(QUESTIONS.length), // Fixed size array
                selectedKeywords: [],
                isAnimating: false
            },

            init() {
                this.render();
            },

            restart() {
                this.state = {
                    step: 'welcome',
                    quizIndex: 0,
                    maxReachedIndex: 0,
                    quizAnswers: new Array(QUESTIONS.length),
                    selectedKeywords: [],
                    isAnimating: false
                };
                KEYWORDS.sort(() => Math.random() - 0.5); // Reshuffle
                this.render();
            },

            setStep(step) {
                this.state.step = step;
                window.scrollTo(0,0);
                this.render();
            },

            // --- QUIZ ACTIONS ---
            handleOptionSelect(option) {
                if (this.state.isAnimating) return;
                this.state.isAnimating = true;

                // Save answer
                this.state.quizAnswers[this.state.quizIndex] = option;
                
                // Re-render to show checkmark immediately
                this.render();

                setTimeout(() => {
                    if (this.state.quizIndex < QUESTIONS.length - 1) {
                        this.state.quizIndex++;
                        this.state.maxReachedIndex = Math.max(this.state.maxReachedIndex, this.state.quizIndex);
                    } else {
                        // Finished quiz
                        this.setStep('keywords');
                    }
                    this.state.isAnimating = false;
                    this.render();
                }, 400);
            },

            handleBack() {
                if (this.state.quizIndex > 0 && !this.state.isAnimating) {
                    this.state.isAnimating = true;
                    this.render(); // trigger animation class logic if needed (or just timeout)
                    setTimeout(() => {
                        this.state.quizIndex--;
                        this.state.isAnimating = false;
                        this.render();
                    }, 300);
                }
            },

            handleForward() {
                const canGoForward = this.state.quizIndex < this.state.maxReachedIndex || (this.state.quizIndex === QUESTIONS.length - 1 && this.state.quizAnswers[this.state.quizIndex]);
                
                if (canGoForward && !this.state.isAnimating) {
                    if (this.state.quizIndex < QUESTIONS.length - 1) {
                        this.state.isAnimating = true;
                        setTimeout(() => {
                            this.state.quizIndex++;
                            this.state.isAnimating = false;
                            this.render();
                        }, 300);
                    } else {
                        this.setStep('keywords');
                    }
                }
            },

            // --- KEYWORD ACTIONS ---
            toggleKeyword(id) {
                const index = this.state.selectedKeywords.findIndex(k => k.id === id);
                if (index >= 0) {
                    this.state.selectedKeywords.splice(index, 1);
                } else {
                    if (this.state.selectedKeywords.length < 5) {
                        const kw = KEYWORDS.find(k => k.id === id);
                        this.state.selectedKeywords.push(kw);
                    }
                }
                this.render();
            },

            submitKeywords() {
                if (this.state.selectedKeywords.length === 5) {
                    this.setStep('results');
                }
            },

            // --- RENDERING ---
            render() {
                const container = document.getElementById('app');
                const stepIndicator = document.getElementById('step-indicator');
                
                container.innerHTML = '';

                // Header update
                if (this.state.step === 'welcome') stepIndicator.textContent = '';
                else if (this.state.step === 'quiz') stepIndicator.textContent = 'Fase 1: Situações';
                else if (this.state.step === 'keywords') stepIndicator.textContent = 'Fase 2: Identidade';
                else if (this.state.step === 'results') stepIndicator.textContent = 'Relatório Final';

                // Screen routing
                switch(this.state.step) {
                    case 'welcome': this.renderWelcome(container); break;
                    case 'quiz': this.renderQuiz(container); break;
                    case 'keywords': this.renderKeywords(container); break;
                    case 'results': this.renderResults(container); break;
                }
            },

            renderWelcome(container) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center min-h-[70vh] w-full max-w-2xl fade-in">
                        <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-8 md:p-12 text-center w-full">
                            <div class="flex justify-center mb-8">
                                <div class="bg-teal-50 p-6 rounded-full text-teal-600">
                                    <div class="w-16 h-16">${Icons.compass}</div>
                                </div>
                            </div>
                            <h1 class="text-3xl md:text-5xl font-bold text-slate-800 mb-6 tracking-tight">
                                Descubra seu <span class="text-teal-600">Temperamento</span>
                            </h1>
                            <p class="text-lg md:text-xl text-slate-600 mb-10 leading-relaxed max-w-xl mx-auto">
                                Uma análise comportamental profunda para impulsionar seu autoconhecimento. Entenda suas forças e como você reage ao mundo.
                            </p>
                            <button onclick="app.setStep('quiz')" class="bg-teal-600 hover:bg-teal-700 text-white shadow-lg shadow-teal-600/20 px-8 py-3 rounded-xl font-semibold text-lg flex items-center gap-2 mx-auto transition-all hover:scale-105 active:scale-95">
                                Iniciar Análise ${Icons.arrowRight}
                            </button>
                            <div class="mt-8 text-sm text-slate-400">Duração estimada: 5 minutos</div>
                        </div>
                    </div>
                `;
            },

            renderQuiz(container) {
                const q = QUESTIONS[this.state.quizIndex];
                const progress = (this.state.quizIndex / QUESTIONS.length) * 100;
                const hasAnswer = !!this.state.quizAnswers[this.state.quizIndex];
                const selectedId = this.state.quizAnswers[this.state.quizIndex]?.id;

                // Logic for Forward Button visibility
                const showForward = !this.state.isAnimating && (
                    this.state.quizIndex < this.state.maxReachedIndex || 
                    (this.state.quizIndex === QUESTIONS.length - 1 && hasAnswer)
                );

                const animClass = this.state.isAnimating ? 'opacity-50 pointer-events-none' : 'fade-in';

                // Options HTML
                const optionsHtml = q.options.map(opt => {
                    const isSelected = selectedId === opt.id;
                    const borderClass = isSelected ? 'border-teal-500 bg-teal-50 ring-1 ring-teal-500 shadow-sm' : 'border-slate-100 hover:border-teal-200 hover:bg-slate-50';
                    const textClass = isSelected ? 'text-teal-900' : 'text-slate-700';
                    const icon = isSelected ? `<div class="text-teal-600">${Icons.checkCircle}</div>` : `<div class="text-slate-300 group-hover:text-teal-400">${Icons.chevronRight}</div>`;
                    
                    return `
                        <button onclick="app.handleOptionSelect({id: '${opt.id}', text: '${opt.text}', type: '${opt.type}'})" 
                            class="group relative flex items-center w-full p-5 text-left border-2 rounded-2xl transition-all duration-200 mb-3 ${borderClass}">
                            <div class="flex-1"><span class="text-lg font-medium ${textClass}">${opt.text}</span></div>
                            <div class="ml-4 transition-all">${icon}</div>
                        </button>
                    `;
                }).join('');

                container.innerHTML = `
                    <div class="max-w-3xl w-full mx-auto">
                        <!-- Nav Bar -->
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-4 h-10">
                                <div class="w-24">
                                    ${this.state.quizIndex > 0 ? `
                                        <button onclick="app.handleBack()" class="flex items-center gap-2 text-slate-500 hover:text-teal-600 transition-colors font-medium text-sm group">
                                            <span class="group-hover:-translate-x-1 transition-transform inline-block w-4">${Icons.arrowLeft}</span> Voltar
                                        </button>
                                    ` : ''}
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Questão ${this.state.quizIndex + 1} de ${QUESTIONS.length}</span>
                                </div>
                                <div class="w-24 flex justify-end">
                                    ${showForward ? `
                                        <button onclick="app.handleForward()" class="flex items-center gap-2 text-teal-600 hover:text-teal-700 transition-colors font-medium text-sm group fade-in">
                                            ${this.state.quizIndex === QUESTIONS.length - 1 ? 'Finalizar' : 'Avançar'}
                                            <span class="group-hover:translate-x-1 transition-transform inline-block w-4">${Icons.arrowRight}</span>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
                                <div class="h-full bg-teal-600 transition-all duration-500 ease-out rounded-full" style="width: ${progress}%"></div>
                            </div>
                        </div>

                        <!-- Card -->
                        <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-6 md:p-10 relative min-h-[400px] ${animClass}">
                            <div class="mb-8">
                                <span class="inline-block px-3 py-1 bg-teal-50 text-teal-700 text-xs font-bold uppercase tracking-wider rounded-full mb-4">${q.category}</span>
                                <h2 class="text-2xl font-bold text-slate-800 leading-snug">${q.text}</h2>
                            </div>
                            <div class="grid gap-2">
                                ${optionsHtml}
                            </div>
                        </div>
                        
                         <div class="mt-6 text-center text-slate-400 text-xs italic">
                            ${this.state.quizIndex < this.state.maxReachedIndex ? "Você está revisando uma questão anterior." : "Responda para avançar automaticamente."}
                        </div>
                    </div>
                `;
            },

            renderKeywords(container) {
                const count = this.state.selectedKeywords.length;
                const isComplete = count === 5;
                
                const keywordsHtml = KEYWORDS.map(kw => {
                    const isSelected = this.state.selectedKeywords.some(k => k.id === kw.id);
                    const isDisabled = !isSelected && isComplete;
                    
                    let classes = "relative px-4 py-2 rounded-full text-base font-medium transition-all duration-200 border ";
                    if (isSelected) {
                        classes += "bg-teal-600 border-teal-600 text-white shadow-md scale-105 ";
                    } else {
                        classes += "bg-white border-slate-200 text-slate-600 hover:border-teal-300 hover:bg-teal-50 ";
                    }
                    if (isDisabled) classes += "opacity-50 cursor-not-allowed ";
                    else classes += "cursor-pointer ";

                    return `
                        <button onclick="app.toggleKeyword('${kw.id}')" ${isDisabled ? 'disabled' : ''} class="${classes}">
                            ${kw.text} ${isSelected ? '<span class="inline-block ml-1 w-3 align-middle">'+Icons.check+'</span>' : ''}
                        </button>
                    `;
                }).join('');

                container.innerHTML = `
                    <div class="max-w-4xl w-full mx-auto flex flex-col items-center fade-in">
                        <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 w-full p-6 md:p-10">
                            <div class="text-center mb-8">
                                <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-3">Quem é você hoje?</h2>
                                <p class="text-slate-600">Selecione exatamente <strong>5 palavras</strong> que melhor descrevem seu comportamento atual.</p>
                                <div class="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-lg">
                                    <span class="font-bold ${isComplete ? 'text-teal-600' : 'text-slate-500'}">${count} / 5</span>
                                    <span class="text-sm text-slate-500">selecionadas</span>
                                </div>
                            </div>

                            <div class="flex flex-wrap gap-3 justify-center mb-10">
                                ${keywordsHtml}
                            </div>

                            <div class="flex flex-col items-center gap-4">
                                ${!isComplete ? `
                                    <div class="flex items-center gap-2 text-rose-500 text-sm animate-pulse">
                                        <div class="w-4 h-4">${Icons.alert}</div>
                                        <span>Selecione mais ${5 - count} palavras para continuar</span>
                                    </div>
                                ` : ''}
                                
                                <button onclick="app.submitKeywords()" ${!isComplete ? 'disabled' : ''} 
                                    class="px-8 py-3 rounded-xl font-semibold transition-all duration-200 min-w-[200px]
                                    ${isComplete ? 'bg-teal-600 hover:bg-teal-700 text-white shadow-lg cursor-pointer transform hover:scale-105' : 'bg-slate-100 text-slate-400 cursor-not-allowed'}">
                                    Ver Meu Resultado
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderResults(container) {
                // Calculation Logic
                const scores = { 'A': 0, 'B': 0, 'C': 0, 'D': 0 };
                
                // Quiz (weight 2)
                this.state.quizAnswers.forEach(ans => { if(ans) scores[ans.type] += 2; });
                // Keywords (weight 1)
                this.state.selectedKeywords.forEach(kw => { scores[kw.type] += 1; });

                const totalPoints = Object.values(scores).reduce((a, b) => a + b, 0);
                
                const chartData = Object.keys(scores).map(key => {
                    const profile = PROFILES[key];
                    return {
                        ...profile,
                        score: scores[key],
                        percentage: Math.round((scores[key] / totalPoints) * 100)
                    };
                }).sort((a, b) => b.score - a.score);

                const winner = chartData[0];

                // Chart Bars HTML
                const barsHtml = chartData.map(d => `
                    <div class="mb-4">
                        <div class="flex justify-between text-sm font-semibold text-slate-600 mb-1">
                            <span>${d.alias}</span>
                            <span>${d.percentage}%</span>
                        </div>
                        <div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
                            <div class="${d.bg} h-full rounded-full transition-all duration-1000 ease-out" style="width: 0%" id="bar-${d.id}"></div>
                        </div>
                    </div>
                `).join('');

                // Trigger animation for bars after render
                setTimeout(() => {
                    chartData.forEach(d => {
                        const el = document.getElementById(`bar-${d.id}`);
                        if(el) el.style.width = `${d.percentage}%`;
                    });
                }, 100);

                container.innerHTML = `
                    <div class="max-w-5xl w-full mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6 fade-in">
                        <!-- Main Result -->
                        <div class="lg:col-span-2 space-y-6">
                            <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-8 border-t-8" style="border-color: ${winner.color}">
                                <div class="mb-2 uppercase tracking-wide text-xs font-bold text-slate-400">Seu temperamento predominante é</div>
                                <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-4">
                                    ${winner.alias} <span class="text-lg font-normal text-slate-500">(${winner.name})</span>
                                </h1>
                                <p class="text-lg text-slate-600 leading-relaxed mb-6">${winner.description}</p>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                                    <div class="bg-teal-50 p-4 rounded-xl">
                                        <h3 class="font-bold text-teal-800 mb-2 flex items-center gap-2">
                                            <div class="w-5 h-5">${Icons.checkCircle}</div> Pontos Fortes
                                        </h3>
                                        <ul class="space-y-1">
                                            ${winner.strengths.map(s => `<li class="text-sm text-teal-700">• ${s}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div class="bg-rose-50 p-4 rounded-xl">
                                        <h3 class="font-bold text-rose-800 mb-2 flex items-center gap-2">
                                            <div class="w-5 h-5">${Icons.alert}</div> Pontos de Atenção
                                        </h3>
                                        <ul class="space-y-1">
                                            ${winner.weaknesses.map(w => `<li class="text-sm text-rose-700">• ${w}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Chart Section -->
                            <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-6">
                                <h3 class="text-xl font-bold text-slate-800 mb-6">Composição do seu Perfil</h3>
                                ${barsHtml}
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div class="space-y-6">
                            <div class="bg-slate-800 text-white rounded-3xl shadow-xl p-6">
                                <h3 class="text-xl font-bold mb-4">Próximos Passos</h3>
                                <p class="text-slate-300 mb-6 text-sm">Agora que você conhece seu perfil, use este conhecimento para melhorar sua comunicação.</p>
                                <div class="space-y-3">
                                    <button onclick="navigator.clipboard.writeText(window.location.href).then(() => alert('Link copiado!'))" class="w-full bg-rose-500 hover:bg-rose-600 text-white py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-colors">
                                        <div class="w-4 h-4">${Icons.share}</div> Compartilhar
                                    </button>
                                    <button onclick="app.restart()" class="w-full border-2 border-slate-600 text-slate-200 hover:bg-slate-700 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-colors">
                                        <div class="w-4 h-4">${Icons.refresh}</div> Refazer Teste
                                    </button>
                                </div>
                            </div>
                            <div class="text-center text-xs text-slate-400">Desenvolvido para análise comportamental.</div>
                        </div>
                    </div>
                `;
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>
</html>